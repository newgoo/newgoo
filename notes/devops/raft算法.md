raft算法
---
#### 主要内容
Paxos和Raft都是为了实现Consensus一致性这个目标，这个过程如同选举一样，参选者需要说服大多数选民(服务器)投票给他，一旦选定后就强制跟随其操作;
为了以容错方式达成一致，我们不可能要求所有服务器100%都达成一致状态，只要超过半数的大多数服务器达成一致就可以了，假设有N台服务器，N/2 +1 就超过半数，代表大多数了。
任何一个服务器都可能担任一下的角色   
    * Leader: 处理所有客户端交互，日志复制等，一般一次只有一个Leader.  
    * Follower: 类似选民，完全被动  
    * Candidate候选人: 类似Proposer律师，可以被选为一个新的领导人。    
#### 选举过程
* 两个阶段  
    * 第一阶段  
任何一个服务器都可以成为一个候选者Candidate，它向其他服务器Follower发出要求选举自己的请求，其他服务器统一了，就发出ok，如果其中出现网络波动等情况，某一台机器宕机了，不能收到，或者把自己选为leader，但是如果超过半数，就可以成为leader并通知其他客户端，他已经是leader，要求所有Follower强制听从自己(日志复制-心跳日志复制),如果leader宕机，这时候又会从新选举出新的leader来代替原来的leader
    * 第二阶段  
ps: `如果票数相同情况` 
选票是有一个超时时间300ms，这个时间如果持平，则需要进行新的一轮投票，其他的后选择必须投优先收到投票邀请的候选者，后来的就落选，变成了follower

#### 日志复制处理
* 过程
    * 假设Leader领导人已经选出，这时客户端发出增加一个日志的要求，比如日志是"set"
    * 所有follower需要听从leader，将日志复制进去，发出commit ok
    * 在下一个heartbeat中，leader会要求所有follower更新commit
* 网络异常
    * 由于网络原因导致leader无法通知follower，那这些follower就没有leader，则会在camdidate重新选择leader，当网络恢复的时候，原来的follower的所有commit都需要回滚，并且被强制接受新leader的所有commit